require_relative '../spec_helper'

describe "Timetable Page",js: true do
   before(:all) do
    @user1 = FactoryGirl.create(:user, :device_identifier => "a9c72e102f1bc1b0")
    @user2 = FactoryGirl.create(:user, :device_identifier => "7d94095209b6e051")
    @user3 = FactoryGirl.create(:user, :device_identifier => "85718da6d39b75c5")
    @user4 = FactoryGirl.create(:user, :device_identifier => "4BA905D6-443D-4631-A7BD-DEDEA1638BA1")
    @user5 = FactoryGirl.create(:user, :device_identifier => "9dce6d95d8b1ae67")
    @users = [@user1.jabber_id, @user2.jabber_id, @user3.jabber_id, @user4.jabber_id, @user5.jabber_id]
    @push = Push.new(@users, "Hi")
  end

  after(:all) do
    @user1.destroy
    @user2.destroy
    @user3.destroy
    @user4.destroy
    @user5.destroy
   
  end
	subject { page }

  let(:user) { FactoryGirl.create(:user) }

  before do
  	 visit '/'
	  click_link "Log In"

	  fill_in "session_email",with: user.email
	  fill_in "session_password",with:user.password
	  
	  within("#login-content") do
	  
     click_button "Login"
     
	   
    end
  end

  describe "timetable creation" do
  	

  	describe "with valid information" ,pending: true do
      it " should create the timetable" do
        group = Group.create(name:"Electronics",group_code:"9A2KVG")
        
        params = {"timetable"=>{"members"=>@users,"entries"=>"[[[{\"from_hours\":\"09\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"11\",\"batch\":\"C1\",\"weekday\":\"Monday\",\"$$hashKey\":\"05M\",\"teacher\":\"teacher1\",\"subject\":\"subject1\",\"room\":\"room1\"},{\"from_hours\":\"09\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"11\",\"batch\":\"C2\",\"weekday\":\"Monday\",\"$$hashKey\":\"05O\",\"teacher\":\"teacher1\",\"subject\":\"subject1\",\"room\":\"room1\"},{\"from_hours\":\"09\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"11\",\"batch\":\"C3\",\"weekday\":\"Monday\",\"$$hashKey\":\"05Q\",\"teacher\":\"teacher1\",\"subject\":\"subject1\",\"room\":\"room1\"}],[{\"from_hours\":\"09\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"11\",\"weekday\":\"Tuesday\",\"$$hashKey\":\"028\",\"teacher\":\"teacher3\",\"subject\":\"subject3\",\"room\":\"room3\"}],[{\"from_hours\":\"09\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"11\",\"weekday\":\"Wednesday\",\"$$hashKey\":\"02S\"}],[{\"from_hours\":\"09\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"11\",\"batch\":\"C1\",\"weekday\":\"Thursday\",\"$$hashKey\":\"07C\",\"teacher\":\"teacher1\",\"subject\":\"subject1\",\"room\":\"room1\"},{\"from_hours\":\"09\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"11\",\"batch\":\"C2\",\"weekday\":\"Thursday\",\"$$hashKey\":\"07E\",\"teacher\":\"teacher1\",\"subject\":\"subject1\",\"room\":\"room1\"},{\"from_hours\":\"09\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"11\",\"batch\":\"C3\",\"weekday\":\"Thursday\",\"$$hashKey\":\"07G\",\"teacher\":\"teacher1\",\"subject\":\"subject1\",\"room\":\"room1\"}],[{\"from_hours\":\"09\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"11\",\"weekday\":\"Friday\",\"$$hashKey\":\"03W\",\"teacher\":\"teacher3\",\"subject\":\"subject2\",\"room\":\"room2\"}],[{\"from_hours\":\"09\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"11\",\"weekday\":\"Saturday\",\"$$hashKey\":\"04G\",\"teacher\":\"teacher3\"}],[{\"from_hours\":\"09\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"11\",\"weekday\":\"Sunday\",\"$$hashKey\":\"050\",\"subject\":\"subject1\",\"room\":\"room2\"}]],[[{\"from_hours\":\"11\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"14\",\"weekday\":\"Monday\",\"$$hashKey\":\"09G\",\"teacher\":\"teacher2\",\"subject\":\"subject1\",\"room\":\"room1\"}],[{\"from_hours\":\"11\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"14\",\"weekday\":\"Tuesday\",\"$$hashKey\":\"0A0\",\"subject\":\"subject2\",\"room\":\"room2\",\"teacher\":\"teacher3\"}],[{\"from_hours\":\"11\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"14\",\"weekday\":\"Wednesday\",\"$$hashKey\":\"0AK\",\"subject\":\"subject3\",\"room\":\"room3\"}],[{\"from_hours\":\"11\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"14\",\"weekday\":\"Thursday\",\"$$hashKey\":\"0B4\",\"teacher\":\"teacher3\",\"subject\":\"subject2\",\"room\":\"room2\"}],[{\"from_hours\":\"11\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"14\",\"weekday\":\"Friday\",\"$$hashKey\":\"0BO\",\"subject\":\"subject2\",\"room\":\"room2\",\"teacher\":\"teacher3\"}],[{\"from_hours\":\"11\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"14\",\"weekday\":\"Saturday\",\"$$hashKey\":\"0C8\",\"subject\":\"subject2\",\"room\":\"room2\",\"teacher\":\"teacher1\"}],[{\"from_hours\":\"11\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"14\",\"weekday\":\"Sunday\",\"$$hashKey\":\"0CS\",\"subject\":\"subject1\",\"room\":\"room1\"}]],[[{\"from_hours\":\"15\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"17\",\"weekday\":\"Monday\",\"$$hashKey\":\"0DS\",\"teacher\":\"teacher3\",\"subject\":\"subject2\",\"room\":\"room2\"}],[{\"from_hours\":\"15\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"17\",\"weekday\":\"Tuesday\",\"$$hashKey\":\"0EC\",\"subject\":\"subject3\",\"room\":\"room3\",\"teacher\":\"teacher3\"}],[{\"from_hours\":\"15\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"17\",\"weekday\":\"Wednesday\",\"$$hashKey\":\"0EW\"}],[{\"from_hours\":\"15\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"17\",\"weekday\":\"Thursday\",\"$$hashKey\":\"0FG\",\"subject\":\"subject2\",\"room\":\"room2\",\"teacher\":\"teacher3\"}],[{\"from_hours\":\"15\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"17\",\"weekday\":\"Friday\",\"$$hashKey\":\"0G0\",\"subject\":\"subject2\",\"room\":\"room2\",\"teacher\":\"teacher3\"}],[{\"from_hours\":\"15\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"17\",\"weekday\":\"Saturday\",\"$$hashKey\":\"0GK\",\"subject\":\"subject2\",\"room\":\"room2\"}],[{\"from_hours\":\"15\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"17\",\"weekday\":\"Sunday\",\"$$hashKey\":\"0H4\",\"teacher\":\"teacher3\",\"subject\":\"subject2\",\"room\":\"room2\"}]],[[{\"from_hours\":\"17\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"19\",\"weekday\":\"Monday\",\"$$hashKey\":\"0I4\",\"teacher\":\"teacher2\",\"subject\":\"subject1\",\"room\":\"room1\"}],[{\"from_hours\":\"17\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"19\",\"weekday\":\"Tuesday\",\"$$hashKey\":\"0IO\",\"subject\":\"subject2\",\"room\":\"room2\",\"teacher\":\"teacher3\"}],[{\"from_hours\":\"17\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"19\",\"weekday\":\"Wednesday\",\"$$hashKey\":\"0J8\",\"subject\":\"subject3\",\"room\":\"room3\"}],[{\"from_hours\":\"17\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"19\",\"weekday\":\"Thursday\",\"$$hashKey\":\"0JS\",\"teacher\":\"teacher3\",\"subject\":\"subject2\",\"room\":\"room2\"}],[{\"from_hours\":\"17\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"19\",\"weekday\":\"Friday\",\"$$hashKey\":\"0KC\",\"teacher\":\"teacher3\",\"subject\":\"subject2\",\"room\":\"room2\"}],[{\"from_hours\":\"17\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"19\",\"weekday\":\"Saturday\",\"$$hashKey\":\"0KW\",\"teacher\":\"teacher3\",\"subject\":\"subject2\",\"room\":\"room2\"}],[{\"from_hours\":\"17\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"19\",\"weekday\":\"Sunday\",\"$$hashKey\":\"0LG\",\"teacher\":\"teacher3\",\"subject\":\"subject2\",\"room\":\"room2\"}]]]", "group"=>{"name"=>"dsadasdas", "group_code"=>"9A2KVG", "$$hashKey"=>"009"}}, "group_id"=>"9A2KVG"}

      	xhr :post, group_timetable_path(group),params
        expect(response.code).to eq("200")
     end
    end
  end

  describe "getting the timetable" do

    it "shoud get me the timetable for the group" do
     group = Group.create(name:"Electronics",group_code:"9A2KVG")

  
        
     params = {"timetable"=>{"members"=>@users,"entries"=>"[[[{\"from_hours\":\"09\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"11\",\"batch\":\"C1\",\"weekday\":\"Monday\",\"$$hashKey\":\"05M\",\"teacher\":\"teacher1\",\"subject\":\"subject1\",\"room\":\"room1\"},{\"from_hours\":\"09\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"11\",\"batch\":\"C2\",\"weekday\":\"Monday\",\"$$hashKey\":\"05O\",\"teacher\":\"teacher1\",\"subject\":\"subject1\",\"room\":\"room1\"},{\"from_hours\":\"09\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"11\",\"batch\":\"C3\",\"weekday\":\"Monday\",\"$$hashKey\":\"05Q\",\"teacher\":\"teacher1\",\"subject\":\"subject1\",\"room\":\"room1\"}],[{\"from_hours\":\"09\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"11\",\"weekday\":\"Tuesday\",\"$$hashKey\":\"028\",\"teacher\":\"teacher3\",\"subject\":\"subject3\",\"room\":\"room3\"}],[{\"from_hours\":\"09\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"11\",\"weekday\":\"Wednesday\",\"$$hashKey\":\"02S\"}],[{\"from_hours\":\"09\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"11\",\"batch\":\"C1\",\"weekday\":\"Thursday\",\"$$hashKey\":\"07C\",\"teacher\":\"teacher1\",\"subject\":\"subject1\",\"room\":\"room1\"},{\"from_hours\":\"09\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"11\",\"batch\":\"C2\",\"weekday\":\"Thursday\",\"$$hashKey\":\"07E\",\"teacher\":\"teacher1\",\"subject\":\"subject1\",\"room\":\"room1\"},{\"from_hours\":\"09\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"11\",\"batch\":\"C3\",\"weekday\":\"Thursday\",\"$$hashKey\":\"07G\",\"teacher\":\"teacher1\",\"subject\":\"subject1\",\"room\":\"room1\"}],[{\"from_hours\":\"09\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"11\",\"weekday\":\"Friday\",\"$$hashKey\":\"03W\",\"teacher\":\"teacher3\",\"subject\":\"subject2\",\"room\":\"room2\"}],[{\"from_hours\":\"09\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"11\",\"weekday\":\"Saturday\",\"$$hashKey\":\"04G\",\"teacher\":\"teacher3\"}],[{\"from_hours\":\"09\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"11\",\"weekday\":\"Sunday\",\"$$hashKey\":\"050\",\"subject\":\"subject1\",\"room\":\"room2\"}]],[[{\"from_hours\":\"11\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"14\",\"weekday\":\"Monday\",\"$$hashKey\":\"09G\",\"teacher\":\"teacher2\",\"subject\":\"subject1\",\"room\":\"room1\"}],[{\"from_hours\":\"11\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"14\",\"weekday\":\"Tuesday\",\"$$hashKey\":\"0A0\",\"subject\":\"subject2\",\"room\":\"room2\",\"teacher\":\"teacher3\"}],[{\"from_hours\":\"11\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"14\",\"weekday\":\"Wednesday\",\"$$hashKey\":\"0AK\",\"subject\":\"subject3\",\"room\":\"room3\"}],[{\"from_hours\":\"11\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"14\",\"weekday\":\"Thursday\",\"$$hashKey\":\"0B4\",\"teacher\":\"teacher3\",\"subject\":\"subject2\",\"room\":\"room2\"}],[{\"from_hours\":\"11\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"14\",\"weekday\":\"Friday\",\"$$hashKey\":\"0BO\",\"subject\":\"subject2\",\"room\":\"room2\",\"teacher\":\"teacher3\"}],[{\"from_hours\":\"11\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"14\",\"weekday\":\"Saturday\",\"$$hashKey\":\"0C8\",\"subject\":\"subject2\",\"room\":\"room2\",\"teacher\":\"teacher1\"}],[{\"from_hours\":\"11\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"14\",\"weekday\":\"Sunday\",\"$$hashKey\":\"0CS\",\"subject\":\"subject1\",\"room\":\"room1\"}]],[[{\"from_hours\":\"15\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"17\",\"weekday\":\"Monday\",\"$$hashKey\":\"0DS\",\"teacher\":\"teacher3\",\"subject\":\"subject2\",\"room\":\"room2\"}],[{\"from_hours\":\"15\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"17\",\"weekday\":\"Tuesday\",\"$$hashKey\":\"0EC\",\"subject\":\"subject3\",\"room\":\"room3\",\"teacher\":\"teacher3\"}],[{\"from_hours\":\"15\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"17\",\"weekday\":\"Wednesday\",\"$$hashKey\":\"0EW\"}],[{\"from_hours\":\"15\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"17\",\"weekday\":\"Thursday\",\"$$hashKey\":\"0FG\",\"subject\":\"subject2\",\"room\":\"room2\",\"teacher\":\"teacher3\"}],[{\"from_hours\":\"15\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"17\",\"weekday\":\"Friday\",\"$$hashKey\":\"0G0\",\"subject\":\"subject2\",\"room\":\"room2\",\"teacher\":\"teacher3\"}],[{\"from_hours\":\"15\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"17\",\"weekday\":\"Saturday\",\"$$hashKey\":\"0GK\",\"subject\":\"subject2\",\"room\":\"room2\"}],[{\"from_hours\":\"15\",\"from_minutes\":\"10\",\"to_minutes\":\"20\",\"to_hours\":\"17\",\"weekday\":\"Sunday\",\"$$hashKey\":\"0H4\",\"teacher\":\"teacher3\",\"subject\":\"subject2\",\"room\":\"room2\"}]],[[{\"from_hours\":\"17\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"19\",\"weekday\":\"Monday\",\"$$hashKey\":\"0I4\",\"teacher\":\"teacher2\",\"subject\":\"subject1\",\"room\":\"room1\"}],[{\"from_hours\":\"17\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"19\",\"weekday\":\"Tuesday\",\"$$hashKey\":\"0IO\",\"subject\":\"subject2\",\"room\":\"room2\",\"teacher\":\"teacher3\"}],[{\"from_hours\":\"17\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"19\",\"weekday\":\"Wednesday\",\"$$hashKey\":\"0J8\",\"subject\":\"subject3\",\"room\":\"room3\"}],[{\"from_hours\":\"17\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"19\",\"weekday\":\"Thursday\",\"$$hashKey\":\"0JS\",\"teacher\":\"teacher3\",\"subject\":\"subject2\",\"room\":\"room2\"}],[{\"from_hours\":\"17\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"19\",\"weekday\":\"Friday\",\"$$hashKey\":\"0KC\",\"teacher\":\"teacher3\",\"subject\":\"subject2\",\"room\":\"room2\"}],[{\"from_hours\":\"17\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"19\",\"weekday\":\"Saturday\",\"$$hashKey\":\"0KW\",\"teacher\":\"teacher3\",\"subject\":\"subject2\",\"room\":\"room2\"}],[{\"from_hours\":\"17\",\"from_minutes\":\"30\",\"to_minutes\":\"10\",\"to_hours\":\"19\",\"weekday\":\"Sunday\",\"$$hashKey\":\"0LG\",\"teacher\":\"teacher3\",\"subject\":\"subject2\",\"room\":\"room2\"}]]]", "group"=>{"name"=>"dsadasdas", "group_code"=>"9A2KVG", "$$hashKey"=>"009"}}, "group_id"=>"9A2KVG"}
     
     xhr :post, group_timetable_path(group),params
     debugger
     xhr :get,group_timetable_path(group),group_code: "9A2KVG"
     
     expect(response.code).to eq("200")

   end

  end
end